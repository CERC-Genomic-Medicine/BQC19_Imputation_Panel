# Ancestry Estimation Pipeline

This repository contains a pipeline for inferring the genetic ancestry of samples using reference PCA space generated by the HDGP+1KG dataset, along with the TRACE algorithm, random forest, and k-nearest neighbour classifiers.

## Pipeline Steps

1. **Generate Reference PCA Space:** This step generates the reference PCA space using the HDGP+1KG dataset. The default value of K is set to 20.

2. **Project Study Samples:** In this step, the pipeline projects the study samples onto the reference PCA space to assess the study principal components (PCs).

3. **Train Classification Models:** Using the reference PCs and reference ancestry labels, the pipeline trains a random forest classification model and a k-nearest neighbour classification model.

4. **Infer Genetic Ancestry Labels:** This step applies the trained classifier to infer the genetic ancestry labels of the study samples.

## Output

The pipeline generates the following outputs:

- **Reference PCs:** The reference principal components generated from the HDGP+1KG dataset.
- **Study PCs:** The principal components of the study samples projected onto the reference PCA space.
- **Study Ancestry Labels:** The inferred genetic ancestry labels for the study samples.
- **3D PCA Plot:** A three-dimensional PCA plot (PC1, PC2, PC3) demonstrating the projection of study samples onto the reference PCA space.
- **Confusion Matrix:** Confusion matrices for each classifier used in the pipeline.

## Running the Pipeline

To run the pipeline, please follow these instructions:

1. Make sure you have the required dependencies installed.
2. Execute the following command:

```bash
sbatch --account="name of the account" --time=48:00:00 --mem=4G -J coverage --wrap="nextflow run /path/to/ancestry.nf" -o ancestry.slurm.log
```

## Dependencies

Ensure you have the following dependencies installed:

- [Nextflow](https://www.nextflow.io/)
- [HDGP+1KG dataset](https://gnomad.broadinstitute.org/news/2020-10-gnomad-v3-1-new-content-methods-annotations-and-data-availability/) 
- [TRACE algorithm](http://csg.sph.umich.edu/chaolong/LASER/)
- Python pakages: pandas, sklearn, matplotlib, numpy


